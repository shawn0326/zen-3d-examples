!function(){var B=new Array(0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745),r=new Array(new Array(0,7,1),new Array(1,12,2),new Array(2,17,3),new Array(3,22,4),new Array(4,7,5),new Array(5,12,6),new Array(6,17,7),new Array(7,22,8),new Array(8,7,9),new Array(9,12,10),new Array(10,17,11),new Array(11,22,12),new Array(12,7,13),new Array(13,12,14),new Array(14,17,15),new Array(15,22,16)),a=new Array(new Array(1,5,17),new Array(6,9,18),new Array(11,14,19),new Array(0,20,20),new Array(5,5,21),new Array(10,9,22),new Array(15,14,23),new Array(4,20,24),new Array(9,5,25),new Array(14,9,26),new Array(3,14,27),new Array(8,20,28),new Array(13,5,29),new Array(2,9,30),new Array(7,14,31),new Array(12,20,32)),e=new Array(new Array(5,4,33),new Array(8,11,34),new Array(11,16,35),new Array(14,23,36),new Array(1,4,37),new Array(4,11,38),new Array(7,16,39),new Array(10,23,40),new Array(13,4,41),new Array(0,11,42),new Array(3,16,43),new Array(6,23,44),new Array(9,4,45),new Array(12,11,46),new Array(15,16,47),new Array(2,23,48)),t=new Array(new Array(0,6,49),new Array(7,10,50),new Array(14,15,51),new Array(5,21,52),new Array(12,6,53),new Array(3,10,54),new Array(10,15,55),new Array(1,21,56),new Array(8,6,57),new Array(15,10,58),new Array(6,15,59),new Array(13,21,60),new Array(4,6,61),new Array(11,10,62),new Array(2,15,63),new Array(9,21,64));var T=new Array(new Array(function(r,a,e){return r&a|~r&e},r),new Array(function(r,a,e){return r&e|a&~e},a),new Array(function(r,a,e){return r^a^e},e),new Array(function(r,a,e){return a^(r|~e)},t));function S(r){return String.fromCharCode(255&r)+String.fromCharCode(r>>>8&255)+String.fromCharCode(r>>>16&255)+String.fromCharCode(r>>>24&255)}function _(r){for(;r<0;)r+=4294967296;for(;4294967295<r;)r-=4294967296;return r}zen3d.md5=function(r){var a,e,t,n;for(n=function(r){var a,e,t,n,o,i,g,b,c,s,h,f,u,y,l,v,x,d,w,A,p,z,m,C,V,F,M;if(t=new Array(1732584193,4023233417,2562383102,271733878),0<(g=(i=63&(o=r.length))<56?56-i:120-i))for(r+="Â€",s=0;s<g-1;s++)r+="\0";for(r+=S(8*o),r+=S(0),o+=g+8,a=new Array(0,1,2,3),e=new Array(16),n=new Array(4),f=0;f<o;f+=64){for(s=0,h=f;s<16;s++,h+=4)e[s]=r.charCodeAt(h)|r.charCodeAt(h+1)<<8|r.charCodeAt(h+2)<<16|r.charCodeAt(h+3)<<24;for(s=0;s<4;s++)n[s]=t[s];for(s=0;s<4;s++)for(b=T[s][0],c=T[s][1],h=0;h<16;h++)y=e,l=n,v=b,x=a,d=c[h],M=F=V=C=m=z=p=A=w=void 0,w=x[0],A=x[1],p=x[2],z=x[3],m=d[0],C=d[1],V=d[2],M=v(l[A],l[p],l[z]),F=(F=_(F=l[w]+M+y[m]+B[V]))<<C|F>>>32-C,F+=l[A],l[w]=_(F),u=a[0],a[0]=a[3],a[3]=a[2],a[2]=a[1],a[1]=u;for(s=0;s<4;s++)t[s]+=n[s],t[s]=_(t[s])}return S(t[0])+S(t[1])+S(t[2])+S(t[3])}(r),e="",a=0;a<16;a++)t=n.charCodeAt(a),e+="0123456789abcdef".charAt(t>>4&15),e+="0123456789abcdef".charAt(15&t);return e}}(),zen3d.VOXData=function(){this.size=null,this.voxels=[],this.palette=[],this.anim=[{size:null,voxels:[]}]},zen3d.VOXDefaultPalette=[{r:255,g:255,b:255,a:255},{r:255,g:255,b:255,a:255},{r:255,g:255,b:204,a:255},{r:255,g:255,b:153,a:255},{r:255,g:255,b:102,a:255},{r:255,g:255,b:51,a:255},{r:255,g:255,b:0,a:255},{r:255,g:204,b:255,a:255},{r:255,g:204,b:204,a:255},{r:255,g:204,b:153,a:255},{r:255,g:204,b:102,a:255},{r:255,g:204,b:51,a:255},{r:255,g:204,b:0,a:255},{r:255,g:153,b:255,a:255},{r:255,g:153,b:204,a:255},{r:255,g:153,b:153,a:255},{r:255,g:153,b:102,a:255},{r:255,g:153,b:51,a:255},{r:255,g:153,b:0,a:255},{r:255,g:102,b:255,a:255},{r:255,g:102,b:204,a:255},{r:255,g:102,b:153,a:255},{r:255,g:102,b:102,a:255},{r:255,g:102,b:51,a:255},{r:255,g:102,b:0,a:255},{r:255,g:51,b:255,a:255},{r:255,g:51,b:204,a:255},{r:255,g:51,b:153,a:255},{r:255,g:51,b:102,a:255},{r:255,g:51,b:51,a:255},{r:255,g:51,b:0,a:255},{r:255,g:0,b:255,a:255},{r:255,g:0,b:204,a:255},{r:255,g:0,b:153,a:255},{r:255,g:0,b:102,a:255},{r:255,g:0,b:51,a:255},{r:255,g:0,b:0,a:255},{r:204,g:255,b:255,a:255},{r:204,g:255,b:204,a:255},{r:204,g:255,b:153,a:255},{r:204,g:255,b:102,a:255},{r:204,g:255,b:51,a:255},{r:204,g:255,b:0,a:255},{r:204,g:204,b:255,a:255},{r:204,g:204,b:204,a:255},{r:204,g:204,b:153,a:255},{r:204,g:204,b:102,a:255},{r:204,g:204,b:51,a:255},{r:204,g:204,b:0,a:255},{r:204,g:153,b:255,a:255},{r:204,g:153,b:204,a:255},{r:204,g:153,b:153,a:255},{r:204,g:153,b:102,a:255},{r:204,g:153,b:51,a:255},{r:204,g:153,b:0,a:255},{r:204,g:102,b:255,a:255},{r:204,g:102,b:204,a:255},{r:204,g:102,b:153,a:255},{r:204,g:102,b:102,a:255},{r:204,g:102,b:51,a:255},{r:204,g:102,b:0,a:255},{r:204,g:51,b:255,a:255},{r:204,g:51,b:204,a:255},{r:204,g:51,b:153,a:255},{r:204,g:51,b:102,a:255},{r:204,g:51,b:51,a:255},{r:204,g:51,b:0,a:255},{r:204,g:0,b:255,a:255},{r:204,g:0,b:204,a:255},{r:204,g:0,b:153,a:255},{r:204,g:0,b:102,a:255},{r:204,g:0,b:51,a:255},{r:204,g:0,b:0,a:255},{r:153,g:255,b:255,a:255},{r:153,g:255,b:204,a:255},{r:153,g:255,b:153,a:255},{r:153,g:255,b:102,a:255},{r:153,g:255,b:51,a:255},{r:153,g:255,b:0,a:255},{r:153,g:204,b:255,a:255},{r:153,g:204,b:204,a:255},{r:153,g:204,b:153,a:255},{r:153,g:204,b:102,a:255},{r:153,g:204,b:51,a:255},{r:153,g:204,b:0,a:255},{r:153,g:153,b:255,a:255},{r:153,g:153,b:204,a:255},{r:153,g:153,b:153,a:255},{r:153,g:153,b:102,a:255},{r:153,g:153,b:51,a:255},{r:153,g:153,b:0,a:255},{r:153,g:102,b:255,a:255},{r:153,g:102,b:204,a:255},{r:153,g:102,b:153,a:255},{r:153,g:102,b:102,a:255},{r:153,g:102,b:51,a:255},{r:153,g:102,b:0,a:255},{r:153,g:51,b:255,a:255},{r:153,g:51,b:204,a:255},{r:153,g:51,b:153,a:255},{r:153,g:51,b:102,a:255},{r:153,g:51,b:51,a:255},{r:153,g:51,b:0,a:255},{r:153,g:0,b:255,a:255},{r:153,g:0,b:204,a:255},{r:153,g:0,b:153,a:255},{r:153,g:0,b:102,a:255},{r:153,g:0,b:51,a:255},{r:153,g:0,b:0,a:255},{r:102,g:255,b:255,a:255},{r:102,g:255,b:204,a:255},{r:102,g:255,b:153,a:255},{r:102,g:255,b:102,a:255},{r:102,g:255,b:51,a:255},{r:102,g:255,b:0,a:255},{r:102,g:204,b:255,a:255},{r:102,g:204,b:204,a:255},{r:102,g:204,b:153,a:255},{r:102,g:204,b:102,a:255},{r:102,g:204,b:51,a:255},{r:102,g:204,b:0,a:255},{r:102,g:153,b:255,a:255},{r:102,g:153,b:204,a:255},{r:102,g:153,b:153,a:255},{r:102,g:153,b:102,a:255},{r:102,g:153,b:51,a:255},{r:102,g:153,b:0,a:255},{r:102,g:102,b:255,a:255},{r:102,g:102,b:204,a:255},{r:102,g:102,b:153,a:255},{r:102,g:102,b:102,a:255},{r:102,g:102,b:51,a:255},{r:102,g:102,b:0,a:255},{r:102,g:51,b:255,a:255},{r:102,g:51,b:204,a:255},{r:102,g:51,b:153,a:255},{r:102,g:51,b:102,a:255},{r:102,g:51,b:51,a:255},{r:102,g:51,b:0,a:255},{r:102,g:0,b:255,a:255},{r:102,g:0,b:204,a:255},{r:102,g:0,b:153,a:255},{r:102,g:0,b:102,a:255},{r:102,g:0,b:51,a:255},{r:102,g:0,b:0,a:255},{r:51,g:255,b:255,a:255},{r:51,g:255,b:204,a:255},{r:51,g:255,b:153,a:255},{r:51,g:255,b:102,a:255},{r:51,g:255,b:51,a:255},{r:51,g:255,b:0,a:255},{r:51,g:204,b:255,a:255},{r:51,g:204,b:204,a:255},{r:51,g:204,b:153,a:255},{r:51,g:204,b:102,a:255},{r:51,g:204,b:51,a:255},{r:51,g:204,b:0,a:255},{r:51,g:153,b:255,a:255},{r:51,g:153,b:204,a:255},{r:51,g:153,b:153,a:255},{r:51,g:153,b:102,a:255},{r:51,g:153,b:51,a:255},{r:51,g:153,b:0,a:255},{r:51,g:102,b:255,a:255},{r:51,g:102,b:204,a:255},{r:51,g:102,b:153,a:255},{r:51,g:102,b:102,a:255},{r:51,g:102,b:51,a:255},{r:51,g:102,b:0,a:255},{r:51,g:51,b:255,a:255},{r:51,g:51,b:204,a:255},{r:51,g:51,b:153,a:255},{r:51,g:51,b:102,a:255},{r:51,g:51,b:51,a:255},{r:51,g:51,b:0,a:255},{r:51,g:0,b:255,a:255},{r:51,g:0,b:204,a:255},{r:51,g:0,b:153,a:255},{r:51,g:0,b:102,a:255},{r:51,g:0,b:51,a:255},{r:51,g:0,b:0,a:255},{r:0,g:255,b:255,a:255},{r:0,g:255,b:204,a:255},{r:0,g:255,b:153,a:255},{r:0,g:255,b:102,a:255},{r:0,g:255,b:51,a:255},{r:0,g:255,b:0,a:255},{r:0,g:204,b:255,a:255},{r:0,g:204,b:204,a:255},{r:0,g:204,b:153,a:255},{r:0,g:204,b:102,a:255},{r:0,g:204,b:51,a:255},{r:0,g:204,b:0,a:255},{r:0,g:153,b:255,a:255},{r:0,g:153,b:204,a:255},{r:0,g:153,b:153,a:255},{r:0,g:153,b:102,a:255},{r:0,g:153,b:51,a:255},{r:0,g:153,b:0,a:255},{r:0,g:102,b:255,a:255},{r:0,g:102,b:204,a:255},{r:0,g:102,b:153,a:255},{r:0,g:102,b:102,a:255},{r:0,g:102,b:51,a:255},{r:0,g:102,b:0,a:255},{r:0,g:51,b:255,a:255},{r:0,g:51,b:204,a:255},{r:0,g:51,b:153,a:255},{r:0,g:51,b:102,a:255},{r:0,g:51,b:51,a:255},{r:0,g:51,b:0,a:255},{r:0,g:0,b:255,a:255},{r:0,g:0,b:204,a:255},{r:0,g:0,b:153,a:255},{r:0,g:0,b:102,a:255},{r:0,g:0,b:51,a:255},{r:238,g:0,b:0,a:255},{r:221,g:0,b:0,a:255},{r:187,g:0,b:0,a:255},{r:170,g:0,b:0,a:255},{r:136,g:0,b:0,a:255},{r:119,g:0,b:0,a:255},{r:85,g:0,b:0,a:255},{r:68,g:0,b:0,a:255},{r:34,g:0,b:0,a:255},{r:17,g:0,b:0,a:255},{r:0,g:238,b:0,a:255},{r:0,g:221,b:0,a:255},{r:0,g:187,b:0,a:255},{r:0,g:170,b:0,a:255},{r:0,g:136,b:0,a:255},{r:0,g:119,b:0,a:255},{r:0,g:85,b:0,a:255},{r:0,g:68,b:0,a:255},{r:0,g:34,b:0,a:255},{r:0,g:17,b:0,a:255},{r:0,g:0,b:238,a:255},{r:0,g:0,b:221,a:255},{r:0,g:0,b:187,a:255},{r:0,g:0,b:170,a:255},{r:0,g:0,b:136,a:255},{r:0,g:0,b:119,a:255},{r:0,g:0,b:85,a:255},{r:0,g:0,b:68,a:255},{r:0,g:0,b:34,a:255},{r:0,g:0,b:17,a:255},{r:238,g:238,b:238,a:255},{r:221,g:221,b:221,a:255},{r:187,g:187,b:187,a:255},{r:170,g:170,b:170,a:255},{r:136,g:136,b:136,a:255},{r:119,g:119,b:119,a:255},{r:85,g:85,b:85,a:255},{r:68,g:68,b:68,a:255},{r:34,g:34,b:34,a:255},{r:17,g:17,b:17,a:255}],function(){var r=function(r,a,e,t,n,o){this.a=r,this.b=a,this.c=e,this.normal=t||new zen3d.Vector3,this.color=n||new zen3d.Color3,this.materialIndex=void 0!==o?o:0};r.prototype.copy=function(r){return this.a=r.a,this.b=r.b,this.c=r.c,this.normal.copy(r.normal),this.color.copy(r.color),this.materialIndex=r.materialIndex,this},r.prototype.clone=function(){return(new r).copy(this)},zen3d.VOXFace3=r}(),function(){var r=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]};r.prototype.computeFaceNormals=function(){for(var r=new zen3d.Vector3,a=new zen3d.Vector3,e=0,t=this.faces.length;e<t;e++){var n=this.faces[e],o=this.vertices[n.a],i=this.vertices[n.b],g=this.vertices[n.c];r.subVectors(g,i),a.subVectors(o,i),r.cross(a),r.normalize(),n.normal.copy(r)}},r.prototype.merge=function(r,a,e){var t,n=this.vertices.length,o=this.vertices,i=r.vertices,g=this.faces,b=r.faces,c=this.faceVertexUvs[0],s=r.faceVertexUvs[0];void 0===e&&(e=0),void 0!==a&&(t=(new zen3d.Matrix3).setFromMatrix4(a).inverse().transpose());for(var h=0,f=i.length;h<f;h++){var u=i[h].clone();void 0!==a&&u.applyMatrix4(a),o.push(u)}for(h=0,f=b.length;h<f;h++){var y,l=b[h];(y=new zen3d.VOXFace3(l.a+n,l.b+n,l.c+n)).normal.copy(l.normal),void 0!==t&&y.normal.applyMatrix3(t).normalize(),y.color.copy(l.color),y.materialIndex=l.materialIndex+e,g.push(y)}for(h=0,f=s.length;h<f;h++){var v=s[h],x=[];if(void 0!==v){for(var d=0,w=v.length;d<w;d++)x.push(v[d].clone());c.push(x)}}},r.prototype.mergeVertices=function(){var r,a,e,t,n,o,i,g,b={},c=[],s=[],h=Math.pow(10,4);for(e=0,t=this.vertices.length;e<t;e++)r=this.vertices[e],void 0===b[a=Math.round(r.x*h)+"_"+Math.round(r.y*h)+"_"+Math.round(r.z*h)]?(b[a]=e,c.push(this.vertices[e]),s[e]=c.length-1):s[e]=s[b[a]];var f=[];for(e=0,t=this.faces.length;e<t;e++){(n=this.faces[e]).a=s[n.a],n.b=s[n.b],n.c=s[n.c],o=[n.a,n.b,n.c];for(var u=0;u<3;u++)if(o[u]===o[(u+1)%3]){f.push(e);break}}for(e=f.length-1;0<=e;e--){var y=f[e];for(this.faces.splice(y,1),i=0,g=this.faceVertexUvs.length;i<g;i++)this.faceVertexUvs[i].splice(y,1)}var l=this.vertices.length-c.length;return this.vertices=c,l},r.prototype.createGeometry=function(){var r=new zen3d.Geometry,o=[];function a(r,a,e,t){for(var n=0;n<3;n++)o.push(r[n].x,r[n].y,r[n].z),o.push(a[n].x,a[n].y,a[n].z),o.push(e[n].r,e[n].g,e[n].b,1),t?o.push(t[n].x,t[n].y):o.push(0,0)}for(var e=this.faces,t=this.vertices,n=this.faceVertexUvs,i=n[0]&&0<n[0].length,g=(n[1]&&n[1].length,0);g<e.length;g++){var b,c,s,h,f=e[g];b=[t[f.a],t[f.b],t[f.c]];var u=f.normal;c=[u,u,u];var y=f.color;if(s=[y,y,y],!0===i){var l=n[0][g];void 0!==l?h=[l[0],l[1],l[2]]:(console.warn("createGeometry(): Undefined vertexUv ",g),h=[new Vector2,new Vector2,new Vector2])}a(b,c,s,h)}var v,x=new zen3d.InterleavedBuffer(new Float32Array(o),12);return v=new zen3d.InterleavedBufferAttribute(x,3,0),r.addAttribute("a_Position",v),v=new zen3d.InterleavedBufferAttribute(x,3,3),r.addAttribute("a_Normal",v),v=new zen3d.InterleavedBufferAttribute(x,4,6),r.addAttribute("a_Color",v),v=new zen3d.InterleavedBufferAttribute(x,2,10),r.addAttribute("a_Uv",v),r},zen3d.VOXGeometry=r}(),function(){var r=function(){};r.prototype.load=function(r,e,a,t){(new zen3d.FileLoader).setResponseType("arraybuffer").load(r,function(r){var a=this.parse(new Uint8Array(r));e(a)}.bind(this),a,t)},r.prototype.parse=function(r){var a=new e(r);try{return t(a),a.data.size=a.data.anim[0].size,a.data.voxels=a.data.anim[0].voxels,0===a.data.palette.length?a.data.palette=zen3d.VOXDefaultPalette:(a.data.palette.unshift(a.data.palette[0]),a.data.palette.pop()),a.data}catch(r){console.error(r)}},zen3d.VOXLoader=r;var e=function(r){this.uint8Array=r,this.cursor=0,this.data=new zen3d.VOXData,this._currentChunkId=null,this._currentChunkSize=0};e.prototype.next=function(){if(this.uint8Array.byteLength<=this.cursor)throw new Error("uint8Array index out of bounds: "+this.uint8Array.byteLength);return this.uint8Array[this.cursor++]},e.prototype.hasNext=function(){return this.cursor<this.uint8Array.byteLength};var t=function(r){a(r),n(r),o(r)},a=function(r){for(var a="",e=0;e<4;e++)a+=String.fromCharCode(r.next());if("VOX "!==a)throw new Error("invalid magic number '"+a+"'")},n=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);console.info(".vox format version "+a)},o=function(r){if(!r.hasNext())return!1;for(i(r),g(r),b(r),c(r);o(r););return r.hasNext()},i=function(r){for(var a="",e=0;e<4;e++)a+=String.fromCharCode(r.next());r._currentChunkId=a,r._currentChunkSize=0},g=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);r._currentChunkSize=a},b=function(r){for(var a=0;a<4;a++)r.next()*Math.pow(256,a)},c=function(r){switch(r._currentChunkId){case"PACK":s(r);break;case"SIZE":h(r);break;case"XYZI":f(r);break;case"RGBA":u(r);break;case"MATT":y(r)}},s=function(r){for(var a=0;a<4;a++)r.next()*Math.pow(256,a)},h=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);var t=0;for(e=0;e<4;e++)t+=r.next()*Math.pow(256,e);var n=0;for(e=0;e<4;e++)n+=r.next()*Math.pow(256,e);var o=r.data.anim[r.data.anim.length-1];o.size&&(o={size:null,voxels:[]},r.data.anim.push(o)),o.size={x:a,y:t,z:n}},f=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);var t=r.data.anim[r.data.anim.length-1];t.voxels.length&&(t={size:null,voxels:[]},r.data.anim.push(t));for(e=0;e<a;e++)t.voxels.push({x:r.next(),y:r.next(),z:r.next(),colorIndex:r.next()})},u=function(r){for(var a=0;a<256;a++){var e={r:r.next(),g:r.next(),b:r.next(),a:r.next()};r.data.palette.push(e)}},y=function(r){for(var a=0;a<4;a++)r.next()*Math.pow(256,a);for(a=0;a<4;a++)r.next()*Math.pow(256,a);for(a=0;a<4;a++)r.next()*Math.pow(256,a);var e=0;for(a=0;a<4;a++)e+=r.next()*Math.pow(256,a);var t=0;!!(1&e)&&(t+=1),!!(2&e)&&(t+=1),!!(4&e)&&(t+=1),!!(8&e)&&(t+=1),!!(16&e)&&(t+=1),!!(32&e)&&(t+=1),!!(64&e)&&(t+=1);for(var n=[],o=0;o<t;o++)for(a=n[o]=0;a<4;a++)n[o]+=r.next()*Math.pow(256,a)}}(),function(){var g=function(r,a){g.textureFactory||(g.textureFactory=new zen3d.VOXTextureFactory),a=a||{},this.voxelData=r,this.voxelSize=a.voxelSize||g.DEFAULT_PARAM.voxelSize,this.vertexColor=void 0===a.vertexColor?g.DEFAULT_PARAM.vertexColor:a.vertexColor,this.optimizeFaces=void 0===a.optimizeFaces?g.DEFAULT_PARAM.optimizeFaces:a.optimizeFaces,this.originToBottom=void 0===a.originToBottom?g.DEFAULT_PARAM.originToBottom:a.originToBottom,this.geometry=null,this.material=null,this._build()};g.prototype._build=function(){this.geometry=new zen3d.Geometry,this.material=new zen3d.PhongMaterial;var e=new zen3d.VOXGeometry;this.hashTable=r(this.voxelData.voxels);var t=-.5*(this.voxelData.size.x-1),n=-.5*(this.voxelData.size.y-1),o=this.originToBottom?0:-.5*(this.voxelData.size.z-1),i=new zen3d.Matrix4;this.voxelData.voxels.forEach(function(r){var a=this._createVoxGeometry(r);a&&(i.makeTranslation((r.x+t)*this.voxelSize,(r.z+o)*this.voxelSize,-(r.y+n)*this.voxelSize),e.merge(a,i))}.bind(this)),this.optimizeFaces&&e.mergeVertices(),e.computeFaceNormals(),this.geometry=e.createGeometry(),this.vertexColor?this.material.vertexColors=!0:this.material.diffuseMap=g.textureFactory.getTexture(this.voxelData)},g.prototype._createVoxGeometry=function(t){var n=[];if(this.optimizeFaces&&c.forEach(function(r){this.hashTable.has(t.x+r.x,t.y+r.y,t.z+r.z)&&n.push(r.ignoreFace)}.bind(this)),6===n.length)return null;var r=s.map(function(r){return new zen3d.Vector3(r.x*this.voxelSize*.5,r.y*this.voxelSize*.5,r.z*this.voxelSize*.5)}.bind(this)),a=h.map(function(r){return{faceA:new zen3d.VOXFace3(r.faceA.a,r.faceA.b,r.faceA.c),faceB:new zen3d.VOXFace3(r.faceB.a,r.faceB.b,r.faceB.c)}});if(this.vertexColor)var e=this.voxelData.palette[t.colorIndex],o=new zen3d.Color3(e.r/255,e.g/255,e.b/255);var i=new zen3d.VOXGeometry;i.faceVertexUvs[0]=[],a.forEach(function(r,a){if(!(0<=n.indexOf(a))){if(this.vertexColor)r.faceA.color=o,r.faceB.color=o;else{var e=new zen3d.Vector2((t.colorIndex+.5)/256,.5);i.faceVertexUvs[0].push([e,e,e],[e,e,e])}i.faces.push(r.faceA,r.faceB)}}.bind(this));var g={};i.faces.forEach(function(r){g[r.a]=!0,g[r.b]=!0,g[r.c]=!0});var b=0;return r.forEach(function(r,a){var e;g[a]?i.vertices.push(r):(e=a-b,i.faces.forEach(function(r){r.a>e&&(r.a-=1),r.b>e&&(r.b-=1),r.c>e&&(r.c-=1)}),b+=1)}),i},g.prototype.getTexture=function(){return g.textureFactory.getTexture(this.voxelData)},g.prototype.createMesh=function(){return new zen3d.Mesh(this.geometry,this.material)},g.prototype.isOuterVoxel=function(a){return c.filter(function(r){return this.hashTable.has(a.x+r.x,a.y+r.y,a.z+r.z)}.bind(this)).length<6},g.DEFAULT_PARAM={voxelSize:1,vertexColor:!1,optimizeFaces:!0,originToBottom:!0},g.textureFactory=void 0,zen3d.VOXMeshBuilder=g;var c=[{x:-1,y:0,z:0,ignoreFace:0},{x:1,y:0,z:0,ignoreFace:1},{x:0,y:-1,z:0,ignoreFace:5},{x:0,y:1,z:0,ignoreFace:4},{x:0,y:0,z:-1,ignoreFace:2},{x:0,y:0,z:1,ignoreFace:3}],s=[{x:-1,y:1,z:-1},{x:1,y:1,z:-1},{x:-1,y:1,z:1},{x:1,y:1,z:1},{x:-1,y:-1,z:-1},{x:1,y:-1,z:-1},{x:-1,y:-1,z:1},{x:1,y:-1,z:1}],h=[{faceA:{a:6,b:2,c:0},faceB:{a:6,b:0,c:4}},{faceA:{a:5,b:1,c:3},faceB:{a:5,b:3,c:7}},{faceA:{a:5,b:7,c:6},faceB:{a:5,b:6,c:4}},{faceA:{a:2,b:3,c:1},faceB:{a:2,b:1,c:0}},{faceA:{a:4,b:0,c:1},faceB:{a:4,b:1,c:5}},{faceA:{a:7,b:3,c:2},faceB:{a:7,b:2,c:6}}],t=function(r,a,e){return"x"+r+"y"+a+"z"+e},r=function(r){var a={};return r.forEach(function(r){a[t(r.x,r.y,r.z)]=!0}),a.has=function(r,a,e){return t(r,a,e)in this},a}}(),function(){var r=function(){};r.prototype.createCanvas=function(r){var a=document.createElement("canvas");a.width=256,a.height=1;for(var e=a.getContext("2d"),t=0,n=r.palette.length;t<n;t++){var o=r.palette[t];e.fillStyle="rgb("+o.r+","+o.g+","+o.b+")",e.fillRect(1*t,0,1,1)}return a},r.prototype.getTexture=function(r){var a=r.palette,e=i(a);if(e in o)return o[e];var t=this.createCanvas(r),n=new zen3d.Texture2D;return n.image=t,n.version++,o[e]=n},zen3d.VOXTextureFactory=r;var o={},i=function(r){for(var a="",e=0;e<256;e++){var t=r[e];a+=n(t.r),a+=n(t.g),a+=n(t.b),a+=n(t.a)}return zen3d.md5(a)},n=function(r){var a=r.toString(16);return 1===a.length?"0"+a:a}}();