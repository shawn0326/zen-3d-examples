!function(){var s={CONSTANT:function(){var t,e,i,r,s=this._renderViewport,n=s.x,h=s.y,o=s.z,a=s.w,c=this._scaleFactor;t=n,e=h,i=o,r=a,this._resolutionSize.set(i*c,r*c),this.viewport.set(t,e,i,r)},SHRINK:function(){var t,e,i,r,s=this._renderViewport,n=s.x,h=s.y,o=s.z,a=s.w,c=this._resolutionSize,d=(o-n)/(a-h),l=c.x/c.y;d<l?(i=o,r=Math.floor(i/l)):(r=a,i=Math.floor(r*l)),t=Math.floor((o-i)/2)+n,e=Math.floor((a-r)/2)+h,this.viewport.set(t,e,i,r)},EXPAND:function(){var t,e,i,r,s=this._renderViewport,n=s.x,h=s.y,o=s.z,a=s.w,c=this._resolutionSize,d=(o-n)/(a-h),l=c.x/c.y;d<l?(r=a,i=Math.floor(r*l)):(i=o,r=Math.floor(i/l)),t=Math.floor((o-i)/2)+n,e=Math.floor((a-r)/2)+h,this.viewport.set(t,e,i,r)}},n=function(t,e,i,r){n.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CANVAS2D,this.frustumCulled=!1,this.geometry=new zen3d.Geometry,this.buffer=new zen3d.InterleavedBuffer(new Float32Array,5),this.buffer.dynamic=!0,this.geometry.addAttribute("a_Position",new zen3d.InterleavedBufferAttribute(this.buffer,3,0)),this.geometry.addAttribute("a_Uv",new zen3d.InterleavedBufferAttribute(this.buffer,2,3)),this.geometry.setIndex([]),this.geometry.usageType=zen3d.WEBGL_BUFFER_USAGE.DYNAMIC_DRAW,this.material=new zen3d.Canvas2DMaterial,this.sprites=[],this.drawArray=[],this._isScreenCanvas=void 0===i||i;t=void 0!==t?t:640,e=void 0!==e?e:800;this._size=new zen3d.Vector2(t,e),this._resolutionSize=new zen3d.Vector2(t,e),this._screenMatchMode=r||s.CONSTANT,this._renderViewport=new zen3d.Vector4(0,0,t,e),this._scaleFactor=1,this.viewport=new zen3d.Vector4,this.orthoCamera=new zen3d.Camera,this.orthoCamera.setOrtho(-t/2,t/2,-e/2,e/2,0,1),this.orthoCamera.viewMatrix.getInverse(this.orthoCamera.worldMatrix)};zen3d.inherit(n,zen3d.Object3D),Object.defineProperties(n.prototype,{isScreenCanvas:{get:function(){return this._isScreenCanvas},set:function(t){this._isScreenCanvas=t}}}),n.prototype.setSize=function(t,e){this._isScreenCanvas?(this._resolutionSize.set(t,e),this._screenMatchMode.call(this),this._updateCamera()):this._size.set(t,e)},n.prototype.setRenderViewport=function(t,e,i,r){this._renderViewport.x===t&&this._renderViewport.y===e&&this._renderViewport.z===i&&this._renderViewport.w===r||(this._renderViewport.set(t,e,i,r),this._screenMatchMode.call(this),this._updateCamera())},n.prototype.setScaleFactor=function(t){this._scaleFactor!==t&&(this._scaleFactor=t,this._screenMatchMode.call(this),this._updateCamera())},n.prototype.setScreenMatchMode=function(t){this._screenMatchMode!==t&&(this._screenMatchMode=t,this._screenMatchMode.call(this),this._updateCamera())},n.prototype._updateCamera=function(){this._isScreenCanvas&&(this.orthoCamera.setOrtho(-this._resolutionSize.x/2,this._resolutionSize.x/2,-this._resolutionSize.y/2,this._resolutionSize.y/2,0,1),this.orthoCamera.viewMatrix.getInverse(this.orthoCamera.worldMatrix))},n.prototype.add=function(t){this.children.push(t)},n.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)};var z=[],C=[];n.prototype.updateSprites=function(){for(var t=0,e=0,i=this.sprites,r=this._isScreenCanvas?this._resolutionSize.x:this._size.x,s=this._isScreenCanvas?this._resolutionSize.y:this._size.y,n=0;n<i.length;n++){var h,o,a=(x=i[n]).width,c=x.height,d=x.worldMatrix.elements,l=d[0],p=d[1],u=d[3],f=d[4],y=d[6]-r/2,_=s/2-d[7]-c;o=h=0,z[t++]=l*h+u*o+y,z[t++]=p*h+f*o+_,z[t++]=0,z[t++]=0,z[t++]=1,h=0+a,o=0,z[t++]=l*h+u*o+y,z[t++]=p*h+f*o+_,z[t++]=0,z[t++]=1,z[t++]=1,h=0+a,o=0+c,z[t++]=l*h+u*o+y,z[t++]=p*h+f*o+_,z[t++]=0,z[t++]=1,o=(h=z[t++]=0)+c,z[t++]=l*h+u*o+y,z[t++]=p*h+f*o+_,z[t++]=0,z[t++]=0,z[t++]=0;var v=t/5-4;C[e++]=v+0,C[e++]=v+1,C[e++]=v+2,C[e++]=v+2,C[e++]=v+3,C[e++]=v+0}z.length=t,C.length=e;var w,M=this.geometry;this.buffer.setArray(new Float32Array(z)),M.index.setArray(new Uint16Array(C)),this.buffer.version++,M.index.version++,this.drawArray=[];for(n=0;n<i.length;n++){var x;w!==(x=i[n]).texture?(this.drawArray.push({texture:x.texture,count:1}),w=x.texture):this.drawArray[this.drawArray.length-1].count++}},n.prototype.updateMatrix=function(){n.superClass.updateMatrix.call(this),this.sprites=[];for(var t=this.children,e=0,i=t.length;e<i;e++)this.cacheSprites(t[e]);var r=this.sprites;for(e=0,i=r.length;e<i;e++)r[e].updateMatrix();this.updateSprites()},n.prototype.cacheSprites=function(t){this.sprites.push(t);for(var e=0,i=t.children.length;e<i;e++)this.cacheSprites(t.children[e])},n.SCREEN_MATCH_MODE=s,zen3d.Canvas2D=n}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CANVAS2D,this.depthWrite=!1,this.transparent=!0};zen3d.inherit(t,zen3d.Material),zen3d.Canvas2DMaterial=t}(),function(){var t=function(){this.width=0,this.height=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.anchorX=0,this.anchorY=0,this.matrix=new zen3d.Matrix3,this.worldMatrix=new zen3d.Matrix3,this.children=new Array,this.parent=null,this.boundingBox=new zen3d.Box2};t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1),t.parent=null},t.prototype.getObjectByName=function(t){return this.getObjectByProperty("name",t)},t.prototype.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var i=0,r=this.children.length;i<r;i++){var s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.anchorX*this.width,this.anchorY*this.height);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,r=0,s=i.length;r<s;r++)i[r].updateMatrix()},t.prototype.computeBoundingBox=function(){this.boundingBox.set(this.x,this.y,this.x+this.width,this.y+this.height)},zen3d.Object2D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.texture=null};zen3d.inherit(t,zen3d.Object2D),zen3d.Sprite2D=t}();