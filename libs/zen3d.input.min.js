!function(){var h={TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,WIN:91};function n(e){var t,n,s,i;for(i=(s=(e="string"==typeof(t=e)?(t=t.toUpperCase(),h[t]||t.charCodeAt(0)):t).toString(16).toUpperCase()).length,n=0;n<4-i;n++)s="0"+s;return"U+"+s}var e=function(e,t){t=t||{},this._element=null,this._keyDownHandler=this._handleKeyDown.bind(this),this._keyUpHandler=this._handleKeyUp.bind(this),this._keyPressHandler=this._handleKeyPress.bind(this),this._keymap={},this._lastmap={},e&&this.attach(e),this.preventDefault=t.preventDefault||!1,this.stopPropagation=t.stopPropagation||!1};e.prototype.attach=function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("keydown",this._keyDownHandler,!1),this._element.addEventListener("keypress",this._keyPressHandler,!1),this._element.addEventListener("keyup",this._keyUpHandler,!1)},e.prototype.detach=function(){this._element.removeEventListener("keydown",this._keyDownHandler),this._element.removeEventListener("keypress",this._keyPressHandler),this._element.removeEventListener("keyup",this._keyUpHandler),this._element=null},e.prototype._handleKeyDown=function(e){var t=n(e.keyCode||e.charCode);this._keymap[t]=!0,this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},e.prototype._handleKeyUp=function(e){var t=n(e.keyCode||e.charCode);delete this._keymap[t],this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},e.prototype._handleKeyPress=function(e){n(e.keyCode||e.charCode);this.preventDefault&&e.preventDefault(),this.stopPropagation&&e.stopPropagation()},e.prototype.update=function(){var e;for(e in this._lastmap)delete this._lastmap[e];for(e in this._keymap)this._keymap.hasOwnProperty(e)&&(this._lastmap[e]=this._keymap[e])},e.prototype.isPressed=function(e){var t=n(e);return!!this._keymap[t]},e.prototype.wasPressed=function(e){var t=n(e);return!!this._keymap[t]&&!this._lastmap[t]},e.prototype.wasReleased=function(e){var t=n(keyCode);return!this._keymap[t]&&!!this._lastmap[t]},zen3d.Keyboard=e}(),function(){var e=function(e){this.position={x:0,y:0},this.wheel=0,this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._contextMenuHandler=function(e){e.preventDefault()},this._buttons=[!1,!1,!1],this._lastbuttons=[!1,!1,!1],e&&this.attach(e)};e.prototype.disableContextMenu=function(){this._element&&this._element.addEventListener("contextmenu",this._contextMenuHandler)},e.prototype.enableContextMenu=function(){this._element&&this._element.removeEventListener("contextmenu",this._contextMenuHandler)},e.prototype.attach=function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("mouseup",this._upHandler,!1),this._element.addEventListener("mousedown",this._downHandler,!1),this._element.addEventListener("mousemove",this._moveHandler,!1),this._element.addEventListener("mousewheel",this._wheelHandler,!1),this._element.addEventListener("DOMMouseScroll",this._wheelHandler,!1)},e.prototype.detach=function(){this._element&&(this._element.removeEventListener("mouseup",this._upHandler,!1),this._element.removeEventListener("mousedown",this._downHandler,!1),this._element.removeEventListener("mousemove",this._moveHandler,!1),this._element.removeEventListener("mousewheel",this._wheelHandler,!1),this._element.removeEventListener("DOMMouseScroll",this._wheelHandler,!1),this._element=null)},e.prototype.update=function(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2],this.wheel=0},e.prototype.isPressed=function(e){return this._buttons[e]},e.prototype.wasPressed=function(e){return this._buttons[e]&&!this._lastbuttons[e]},e.prototype.wasReleased=function(e){return!this._buttons[e]&&this._lastbuttons[e]},e.prototype._handleUp=function(e){this._buttons[e.button]=!1},e.prototype._handleDown=function(e){this._buttons[e.button]=!0},e.prototype._handleMove=function(e){this.position.x=e.clientX,this.position.y=e.clientY},e.prototype._handleWheel=function(e){e.detail?this.wheel=-1*e.detail:e.wheelDelta?this.wheel=e.wheelDelta/120:this.wheel=0},zen3d.Mouse=e}(),function(){var i={BEGAN:"began",MOVED:"moved",STATIONARY:"stationary",ENDED:"ended",CANCELED:"canceled"};zen3d.TouchPhase=i;var n=function(){this.altitudeAngle=Math.PI/2,this.azimuthAngle=0,this.deltaPosition={x:0,y:0},this.fingerId=0,this.maximumPossiblePressure=1,this.phase="",this.position={x:0,y:0},this.pressure=1,this.radius={x:0,y:0},this.type="Direct"};n.prototype.set=function(e,t){this.altitudeAngle=e.rotationAngle,this.azimuthAngle=e.rotationAngle,t===i.BEGAN||t===i.STATIONARY?(this.deltaPosition.x=0,this.deltaPosition.y=0):(this.deltaPosition.x=e.clientX-this.position.x,this.deltaPosition.y=e.clientY-this.position.y),this.fingerId=e.identifier,this.phase=t,this.position.x=e.clientX,this.position.y=e.clientY,this.pressure=e.force,this.radius.x=e.radiusX,this.radius.y=e.radiusY},n._pointPool=[],n.create=function(){return this._pointPool.pop()||new n},n.release=function(e){this._pointPool.push(e)},zen3d.TouchPoint=n;var e=function(e){this._touchesMap={},this._touches=[],this.touchCount=0,this._startHandler=this._handleTouchStart.bind(this),this._endHandler=this._handleTouchEnd.bind(this),this._moveHandler=this._handleTouchMove.bind(this),this._cancelHandler=this._handleTouchCancel.bind(this),e&&this.attach(e)};e.prototype.attach=function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("touchstart",this._startHandler,!1),this._element.addEventListener("touchend",this._endHandler,!1),this._element.addEventListener("touchmove",this._moveHandler,!1),this._element.addEventListener("touchcancel",this._cancelHandler,!1)},e.prototype.detach=function(){this._element&&(this._element.removeEventListener("touchstart",this._startHandler,!1),this._element.removeEventListener("touchend",this._endHandler,!1),this._element.removeEventListener("touchmove",this._moveHandler,!1),this._element.removeEventListener("touchcancel",this._cancelHandler,!1)),this._element=null},e.prototype.update=function(){for(var e in this._touchesMap){var t=this._touchesMap[e];if(t.phase===i.BEGAN&&(t.phase=i.STATIONARY),t.phase===i.ENDED||t.phase===i.CANCELED){delete this._touchesMap[e];var n=this._touches.indexOf(t);-1<n&&this._touches.splice(n,1),this.touchCount--}}},e.prototype.getTouch=function(e){return this._touches[e]},e.prototype._getTouch=function(e){var t=this._touchesMap[e];return t||(t=n.create(),this._touchesMap[e]=t,this._touches.push(t),this.touchCount++),t},e.prototype._handleTouchStart=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],s=n.identifier;this._getTouch(s).set(n,i.BEGAN)}},e.prototype._handleTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],s=n.identifier;this._getTouch(s).set(n,i.ENDED)}},e.prototype._handleTouchMove=function(e){e.preventDefault();for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],s=n.identifier;this._getTouch(s).set(n,i.MOVED)}},e.prototype._handleTouchCancel=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],s=n.identifier;this._getTouch(s).set(n,i.CANCELED)}},zen3d.Touch=e}();